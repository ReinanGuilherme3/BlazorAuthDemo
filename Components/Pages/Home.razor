@page "/"

@attribute [Authorize]

@using BlazorAuthDemo.Policies
@inject NavigationManager Navigation

<PageTitle>Home</PageTitle>

<MudContainer Class="mt-8">
    <MudPaper Elevation="4" Class="pa-6 mx-auto" MaxWidth="600px">

        <!-- Logged in / not logged in -->
        <AuthorizeView>
            <Authorized>
                <MudText Typo="Typo.h5" Align="Align.Center">
                    👋 Welcome, <b>@context.User.Identity?.Name</b>
                </MudText>

                <MudDivider Class="my-4" />

                <MudStack Row="true" Justify="Justify.Center" Spacing="2">
                    <MudButton Variant="Variant.Filled" Color="Color.Error" Href="/logout-handler">
                        Logout
                    </MudButton>
                </MudStack>
            </Authorized>

            <NotAuthorized>
                <MudStack AlignItems="AlignItems.Center" Spacing="2">
                    <MudText Typo="Typo.h6">You are not authenticated.</MudText>
                    <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/login">
                        Go to Login
                    </MudButton>
                </MudStack>
            </NotAuthorized>
        </AuthorizeView>

        <MudDivider Class="my-6" />

        <!-- Policies -->
        <MudText Typo="Typo.h6" Align="Align.Center" Class="mb-4">Permissions</MudText>

        <MudGrid>
            <MudItem xs="12" sm="3">
                <AuthorizeView Policy="@AuthPolicy.VIEW">
                    <Authorized>
                        <MudChip T="string" Color="Color.Success" Variant="Variant.Filled">VIEW ✅</MudChip>
                    </Authorized>
                </AuthorizeView>
            </MudItem>

            <MudItem xs="12" sm="3">
                <AuthorizeView Policy="@AuthPolicy.ADD">
                    <Authorized>
                        <MudChip T="string" Color="Color.Info" Variant="Variant.Filled">ADD ➕</MudChip>
                    </Authorized>
                </AuthorizeView>
            </MudItem>

            <MudItem xs="12" sm="3">
                <AuthorizeView Policy="@AuthPolicy.EDIT">
                    <Authorized>
                        <MudChip T="string" Color="Color.Warning" Variant="Variant.Filled">EDIT ✏️</MudChip>
                    </Authorized>
                </AuthorizeView>
            </MudItem>

            <MudItem xs="12" sm="3">
                <AuthorizeView Policy="@AuthPolicy.CREATE">
                    <Authorized>
                        <MudChip T="string" Color="Color.Secondary" Variant="Variant.Filled">CREATE 🛠️</MudChip>
                    </Authorized>
                </AuthorizeView>
            </MudItem>
        </MudGrid>

        <!-- Optional debug: list claims -->
        @*
            <AuthorizeView>
                <Authorized>
                    <MudExpansionPanels Class="mt-4">
                        <MudExpansionPanel Text="User Claims">
                            <MudList>
                                @foreach (var claim in context.User.Claims)
                                {
                                    <MudListItem>@claim.Type : @claim.Value</MudListItem>
                                }
                            </MudList>
                        </MudExpansionPanel>
                    </MudExpansionPanels>
                </Authorized>
            </AuthorizeView>
        *@

    </MudPaper>
</MudContainer>
